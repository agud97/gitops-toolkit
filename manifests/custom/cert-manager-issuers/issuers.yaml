# =============================================================================
# Let's Encrypt Staging ClusterIssuer
# =============================================================================
# Используйте для тестирования (без rate limits)
# =============================================================================

apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-staging
spec:
  acme:
    # Staging server
    server: https://acme-staging-v02.api.letsencrypt.org/directory

    # Email для уведомлений
    email: your-email@example.com  # ⚠️ ИЗМЕНИТЕ

    # Secret для хранения ACME аккаунта
    privateKeySecretRef:
      name: letsencrypt-staging-account-key

    # Solvers
    solvers:
      # HTTP-01 challenge (через Ingress)
      - http01:
          ingress:
            ingressClassName: nginx

      # DNS-01 challenge (для wildcard сертификатов)
      # - dns01:
      #     cloudDNS:
      #       project: my-project
      #       serviceAccountSecretRef:
      #         name: gcp-dns-sa
      #         key: key.json

---
# =============================================================================
# Let's Encrypt Production ClusterIssuer
# =============================================================================
# Используйте для production сертификатов
# =============================================================================

apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    # Production server
    server: https://acme-v02.api.letsencrypt.org/directory

    # Email для уведомлений
    email: your-email@example.com  # ⚠️ ИЗМЕНИТЕ

    # Secret для хранения ACME аккаунта
    privateKeySecretRef:
      name: letsencrypt-prod-account-key

    # Solvers
    solvers:
      # HTTP-01 challenge
      - http01:
          ingress:
            ingressClassName: nginx

---
# =============================================================================
# Self-Signed ClusterIssuer
# =============================================================================
# Для internal сертификатов
# =============================================================================

apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: selfsigned
spec:
  selfSigned: {}

---
# =============================================================================
# CA ClusterIssuer (для internal PKI)
# =============================================================================
# Создаёт сертификаты, подписанные вашим CA
# =============================================================================

# Сначала создайте CA сертификат:
# apiVersion: cert-manager.io/v1
# kind: Certificate
# metadata:
#   name: ca-certificate
#   namespace: cert-manager
# spec:
#   isCA: true
#   commonName: my-ca
#   secretName: ca-key-pair
#   privateKey:
#     algorithm: ECDSA
#     size: 256
#   issuerRef:
#     name: selfsigned
#     kind: ClusterIssuer
#     group: cert-manager.io

# apiVersion: cert-manager.io/v1
# kind: ClusterIssuer
# metadata:
#   name: ca-issuer
# spec:
#   ca:
#     secretName: ca-key-pair

---
# =============================================================================
# Пример Certificate
# =============================================================================

# apiVersion: cert-manager.io/v1
# kind: Certificate
# metadata:
#   name: example-com-tls
#   namespace: default
# spec:
#   secretName: example-com-tls
#   issuerRef:
#     name: letsencrypt-prod
#     kind: ClusterIssuer
#   dnsNames:
#     - example.com
#     - www.example.com
#   # Для wildcard:
#   # dnsNames:
#   #   - "*.example.com"
#   #   - example.com
